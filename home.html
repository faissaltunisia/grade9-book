<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>منصة تِقني AI الشاملة | أ. فيصل العريبي</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython_stdlib.min.js"></script>

    <style>
        :root {
            --neon-p: #a855f7; --neon-c: #22d3ee; --neon-g: #10b981;
            --neon-gold: #fbbf24; --dark: #030712; --glass: rgba(15, 23, 42, 0.95);
        }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; transition: 0.3s; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100vw; background: var(--dark); color: #e2e8f0; overflow: hidden; }

        /* --- الهيكل العام --- */
        .screen { position: fixed; inset: 0; display: none; flex-direction: column; z-index: 10; }
        .active-screen { display: flex; }

        /* --- الترحيب --- */
        #welcome-screen { background: radial-gradient(circle, #1e1b4b 0%, #030712 100%); align-items: center; justify-content: center; z-index: 5000; }
        .logo { font-size: clamp(2.5rem, 8vw, 4rem); font-weight: 900; color: var(--neon-c); text-shadow: 0 0 20px var(--neon-c); }

        /* --- بيئة العمل --- */
        #main-app { padding-bottom: 80px; }
        .workspace { flex: 1; display: flex; flex-direction: column; padding: 10px; gap: 10px; overflow: hidden; }
        
        @media (min-width: 992px) { 
            .workspace { flex-direction: row; } 
            #editor-wrapper { flex: 1.4; } 
            #console-wrapper { flex: 1; }
        }

        #editor { width: 100%; height: 100%; background: #010409; color: #79c0ff; padding: 20px; font-family: 'Fira Code'; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); outline: none; direction: ltr; resize: none; font-size: 1rem; }
        #console { width: 100%; height: 100%; background: #000; color: var(--neon-g); padding: 15px; font-family: 'Fira Code'; border-radius: 15px; border: 1px solid rgba(34,211,238,0.2); overflow-y: auto; direction: ltr; }

        /* --- البطاقات العائمة --- */
        .overlay { 
            position: fixed; bottom: -100%; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 650px; background: var(--glass);
            backdrop-filter: blur(20px); border: 1px solid var(--neon-p);
            border-radius: 25px 25px 0 0; padding: 25px; z-index: 2000;
            box-shadow: 0 -10px 50px #000; max-height: 85vh; overflow-y: auto;
        }
        .overlay.show { bottom: 0; }
        .list-btn { background: rgba(255,255,255,0.05); margin: 8px 0; padding: 15px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 12px; border: 1px solid transparent; }
        .list-btn:hover { background: rgba(168, 85, 247, 0.2); border-color: var(--neon-c); }

        /* --- الشريط السفلي --- */
        .dock { 
            position: fixed; bottom: 12px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 450px; height: 68px; background: var(--glass);
            border-radius: 22px; border: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-around; align-items: center; z-index: 3000;
        }
        .dock-item { color: #94a3b8; cursor: pointer; text-align: center; font-size: 0.75rem; }
        .dock-item i { font-size: 1.5rem; display: block; margin-bottom: 2px; }
        .dock-item.active { color: var(--neon-c); }

        /* --- أدوات التحكم --- */
        .controls { display: flex; gap: 8px; padding: 10px; background: #0f172a; }
        .btn { flex: 1; padding: 12px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; gap: 6px; }
        .btn-run { background: var(--neon-g); color: #000; }
        .btn-ai { background: var(--neon-gold); color: #000; }
        .btn-cancel { background: #ef4444 !important; color: white !important; }

        /* --- المساعد الذكي --- */
        #bot-icon { position: fixed; bottom: 95px; left: 20px; width: 55px; height: 55px; background: var(--neon-p); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1000; cursor: pointer; box-shadow: 0 0 15px var(--neon-p); }
        #chat-window { position: fixed; bottom: 160px; left: 20px; width: 320px; height: 420px; background: #0f172a; border: 1px solid var(--neon-p); border-radius: 20px; display: none; flex-direction: column; z-index: 2000; overflow: hidden; }

        .loader { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 100; border-radius: 15px; color: var(--neon-gold); }
    </style>
</head>
<body onload="brython(); loadDB();">

    <div id="welcome-screen" class="screen active-screen">
        <div class="logo">تِقني AI</div>
        <p style="color:var(--neon-p); margin-top:10px;">بوابة الطلاب نحو عالم البرمجة</p>
        <p style="opacity:0.6; font-size:0.9rem;">إشراف: أ. فيصل العريبي</p>
        <button onclick="enterApp()" style="margin-top:30px; padding:15px 45px; border-radius:30px; border:2px solid var(--neon-c); background:transparent; color:white; cursor:pointer; font-weight:bold;">ابدأ التعلم الآن</button>
    </div>

    <div id="main-app" class="screen">
        <header style="padding:12px 20px; background:rgba(0,0,0,0.5); border-bottom:1px solid var(--neon-p); display:flex; justify-content:space-between; align-items:center;">
            <span id="header-task" style="color:var(--neon-gold); font-weight:bold; font-size:0.9rem;">جاهز للبرمجة؟</span>
            <div style="text-align:left; font-size:0.7rem; opacity:0.6;">المصمم: فيصل العريبي</div>
        </header>

        <div class="workspace">
            <div id="editor-wrapper" style="position:relative;">
                <div id="loading" class="loader"><i class="fas fa-robot fa-spin fa-2x"></i></div>
                <textarea id="editor" spellcheck="false" placeholder="# اختر نشاطاً من قائمة الدروس..."></textarea>
            </div>
            <div id="console-wrapper">
                <div id="console"></div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" style="background:transparent; border:1px solid var(--neon-c); color:var(--neon-c)" onclick="aiAnalyze()"><i class="fas fa-brain"></i> تحليل</button>
            <button class="btn btn-ai" onclick="aiFix()"><i class="fas fa-magic"></i> المعلم الذكي</button>
            <button class="btn btn-run" onclick="window.run_python()"><i class="fas fa-play"></i> تشغيل الكود</button>
        </div>

        <div class="dock">
            <div class="dock-item" onclick="location.reload()"><i class="fas fa-home"></i>الرئيسية</div>
            <div class="dock-item" onclick="openUnits()"><i class="fas fa-book"></i>الدروس</div>
            <div class="dock-item" onclick="openAdmin()"><i class="fas fa-tools"></i>الإدارة</div>
        </div>
    </div>

    <div id="units-card" class="overlay">
        <h3><i class="fas fa-layer-group"></i> الوحدات الدراسية</h3>
        <div id="units-list"></div>
        <button class="btn" style="background:#333; width:100%; margin-top:15px;" onclick="closeOverlays()">إغلاق</button>
    </div>

    <div id="acts-card" class="overlay">
        <h3 id="unit-title" style="color:var(--neon-c)"></h3>
        <div id="acts-list"></div>
        <button class="btn" style="background:#333; width:100%; margin-top:10px;" onclick="openUnits()">رجوع</button>
    </div>

    <div id="brief-card" class="overlay" style="text-align:center;">
        <h2 id="brief-name" style="color:var(--neon-gold)"></h2>
        <div style="text-align:right; background:rgba(255,255,255,0.03); padding:20px; border-radius:15px; margin:15px 0; border-right:4px solid var(--neon-p);">
            <p><b>الدرس:</b> <span id="brief-info"></span></p>
            <p><b>المهمة:</b> <span id="brief-task"></span></p>
            <p style="color:var(--neon-c); font-size:0.9rem;"><i class="fas fa-lightbulb"></i> <span id="brief-tips"></span></p>
        </div>
        <button class="btn btn-run" style="width:100%;" onclick="launchLab()">ابدأ البرمجة الآن</button>
    </div>

    <div id="admin-card" class="overlay">
        <h3><i class="fas fa-plus-circle"></i> إضافة نشاط جديد</h3>
        <div style="display:flex; flex-direction:column; gap:10px;">
            <input type="text" id="in-unit" placeholder="اسم الوحدة (مثال: الوحدة الأولى)" style="padding:12px; background:#000; border:1px solid var(--neon-p); color:white; border-radius:10px;">
            <input type="text" id="in-title" placeholder="عنوان النشاط" style="padding:12px; background:#000; border:1px solid var(--neon-p); color:white; border-radius:10px;">
            <textarea id="in-info" placeholder="محتوى النشاط والشرح..." style="padding:12px; background:#000; border:1px solid var(--neon-p); color:white; border-radius:10px; height:80px;"></textarea>
            <textarea id="in-task" placeholder="المطلوب برمجته..." style="padding:12px; background:#000; border:1px solid var(--neon-p); color:white; border-radius:10px; height:80px;"></textarea>
            <textarea id="in-tips" placeholder="تلميحات مساعدة للطلاب..." style="padding:12px; background:#000; border:1px solid var(--neon-p); color:white; border-radius:10px; height:60px;"></textarea>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-cancel" onclick="closeOverlays()">إلغاء</button>
                <button class="btn btn-run" onclick="saveNewAct()">حفظ ونشر</button>
            </div>
        </div>
    </div>

    <div id="bot-icon" onclick="toggleChat()"><i class="fas fa-robot"></i></div>
    <div id="chat-window">
        <div style="padding:15px; background:var(--neon-p); display:flex; justify-content:space-between; font-weight:bold;">
            <span>مساعد تِقني AI</span>
            <i class="fas fa-times" onclick="toggleChat()" style="cursor:pointer"></i>
        </div>
        <div id="chat-msgs" style="flex:1; padding:15px; overflow-y:auto; background:#020617; font-size:0.85rem;"></div>
        <div style="padding:10px; display:flex; gap:5px; background:#0f172a;">
            <input type="text" id="chat-inp" style="flex:1; background:#1e293b; border:none; color:white; padding:8px; border-radius:8px;">
            <button onclick="askAI()" style="background:var(--neon-p); border:none; color:white; padding:8px 15px; border-radius:8px;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script type="text/python">
        from browser import document, window
        def run_code(ev):
            document["console"].text = ""
            def log(*a): document["console"].text += " ".join(map(str, a)) + "\n"
            try: exec(document["editor"].value, {"print": log, "input": window.prompt})
            except Exception as e: document["console"].text = f">> خطأ برمجي:\n{e}"
        window.run_python = run_code
    </script>

    <script>
        let activities = [];
        let currentActivity = null;

        function loadDB() {
            const data = localStorage.getItem('tech_pro_db');
            if(data) activities = JSON.parse(data);
            else {
                activities = [
                    { id: 1, unit: '1. أساسيات بايثون', title: 'دالة الطباعة', info: 'تستخدم دالة print لعرض المخرجات.', task: 'اطبع اسمك واسم مدرستك.', tips: 'ضع النص بين علامات تنصيص " ".' },
                    { id: 2, unit: '1. أساسيات بايثون', title: 'المتغيرات الرقمية', info: 'المتغيرات تخزن القيم لاستخدامها لاحقاً.', task: 'عرف متغير x=5 و y=10 واطبع ناتج جمعهما.', tips: 'استخدم علامة + للجمع.' },
                    { id: 3, unit: '2. الحلقات والتكرار', title: 'حلقة for', info: 'التكرار يسهل تنفيذ الأوامر المكررة.', task: 'اطبع كلمة "برمجة" 5 مرات.', tips: 'استخدم range(5) مع حلقة for.' }
                ];
                localStorage.setItem('tech_pro_db', JSON.stringify(activities));
            }
        }

        function enterApp() {
            document.getElementById('welcome-screen').classList.remove('active-screen');
            document.getElementById('main-app').classList.add('active-screen');
        }

        function closeOverlays() { document.querySelectorAll('.overlay').forEach(o => o.classList.remove('show')); }

        function openUnits() {
            closeOverlays();
            const list = document.getElementById('units-list');
            const units = [...new Set(activities.map(a => a.unit))];
            list.innerHTML = units.map(u => `<div class="list-btn" onclick="openActs('${u}')"><i class="fas fa-folder" style="color:var(--neon-p)"></i> ${u}</div>`).join('');
            document.getElementById('units-card').classList.add('show');
        }

        function openActs(uName) {
            closeOverlays();
            document.getElementById('unit-title').innerText = uName;
            const list = document.getElementById('acts-list');
            const filtered = activities.filter(a => a.unit === uName);
            list.innerHTML = filtered.map(a => `<div class="list-btn" onclick="openBrief(${a.id})"><b style="color:var(--neon-c)">${a.id}.</b> ${a.title}</div>`).join('');
            document.getElementById('acts-card').classList.add('show');
        }

        function openBrief(id) {
            closeOverlays();
            currentActivity = activities.find(a => a.id === id);
            document.getElementById('brief-name').innerText = currentActivity.title;
            document.getElementById('brief-info').innerText = currentActivity.info;
            document.getElementById('brief-task').innerText = currentActivity.task;
            document.getElementById('brief-tips').innerText = currentActivity.tips;
            document.getElementById('brief-card').classList.add('show');
        }

        function launchLab() {
            closeOverlays();
            document.getElementById('header-task').innerText = currentActivity.title;
            document.getElementById('editor').value = `# نشاط: ${currentActivity.title}\n# المهمة: ${currentActivity.task}\n\n`;
            document.getElementById('console').innerText = ">>> المحرك جاهز للتشغيل...";
        }

        function openAdmin() {
            if(prompt("كلمة مرور المعلم:") === "1234") {
                closeOverlays();
                document.getElementById('admin-card').classList.add('show');
            }
        }

        function saveNewAct() {
            const n = {
                id: activities.length + 1,
                unit: document.getElementById('in-unit').value,
                title: document.getElementById('in-title').value,
                info: document.getElementById('in-info').value,
                task: document.getElementById('in-task').value,
                tips: document.getElementById('in-tips').value
            };
            activities.push(n);
            localStorage.setItem('tech_pro_db', JSON.stringify(activities));
            alert("تم إضافة النشاط بنجاح!");
            closeOverlays();
        }

        async function aiFix() {
            document.getElementById('loading').style.display = 'flex';
            const res = await fetch('https://text.pollinations.ai/', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({messages: [{role: 'system', content: 'Python Teacher. Fix code. Only code output.'}, {role: 'user', content: `Task: ${currentActivity?.task}\nCode: ${document.getElementById('editor').value}`}]})
            });
            document.getElementById('editor').value = (await res.text()).replace(/```python|```/g, '').trim();
            document.getElementById('loading').style.display = 'none';
        }

        async function aiAnalyze() {
            alert("جاري تحليل الكود، انتظر قليلاً...");
            const res = await fetch('https://text.pollinations.ai/', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({messages: [{role: 'system', content: 'حلل الكود بالعربي بأسلوب تعليمي بسيط.'}, {role: 'user', content: document.getElementById('editor').value}]})
            });
            alert(await res.text());
        }

        function toggleChat() {
            const c = document.getElementById('chat-window');
            c.style.display = (c.style.display === 'flex') ? 'none' : 'flex';
        }

        async function askAI() {
            const inp = document.getElementById('chat-inp'), box = document.getElementById('chat-msgs');
            const q = inp.value; inp.value = "";
            box.innerHTML += `<div style="color:var(--neon-c); margin-bottom:10px;">أنت: ${q}</div>`;
            const res = await fetch('https://text.pollinations.ai/', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({messages: [{role:'user', content: q}]})
            });
            box.innerHTML += `<div style="margin-bottom:15px; opacity:0.9;">تِقني: ${await res.text()}</div>`;
            box.scrollTop = box.scrollHeight;
        }
    </script>
</body>
</html>
