<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تِقني AI - النسخة النهائية | أ. فيصل العريبي</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython_stdlib.min.js"></script>

    <style>
        :root {
            --p-color: #a855f7; --c-color: #22d3ee; --g-color: #10b981;
            --gold: #fbbf24; --bg: #020617; --glass: rgba(15, 23, 42, 0.95);
        }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100vw; background: var(--bg); color: #f8fafc; overflow: hidden; }

        /* --- شاشة الترحيب الخيالية --- */
        #welcome-screen {
            position: fixed; inset: 0; background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;
        }
        .light-burst {
            position: absolute; width: 300px; height: 300px; background: var(--c-color);
            filter: blur(120px); border-radius: 50%; opacity: 0.4; animation: burst 5s infinite;
        }
        @keyframes burst { 0%, 100% { transform: scale(1); opacity: 0.3; } 50% { transform: scale(2); opacity: 0.5; } }
        
        .robot-anim { font-size: 5rem; color: var(--c-color); filter: drop-shadow(0 0 20px var(--c-color)); animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* --- الهيكل الرئيسي --- */
        #main-app { display: none; height: 100vh; flex-direction: column; }
        .workspace { flex: 1; display: flex; flex-direction: column; padding: 10px; gap: 10px; overflow: hidden; margin-bottom: 140px; } /* مساحة إضافية للأزرار والدك */
        
        @media (min-width: 992px) { 
            .workspace { flex-direction: row; margin-bottom: 90px; } 
            #ed-box { flex: 1.5; } 
            #con-box { flex: 1; } 
        }

        #editor { width: 100%; height: 100%; background: #010409; color: #79c0ff; padding: 20px; font-family: 'Fira Code'; border-radius: 20px; border: 1px solid rgba(168, 85, 247, 0.3); outline: none; direction: ltr; resize: none; font-size: 1rem; }
        #console { width: 100%; height: 100%; background: #000; color: var(--g-color); padding: 20px; font-family: 'Fira Code'; border-radius: 20px; border: 1px solid rgba(34, 211, 238, 0.3); overflow-y: auto; direction: ltr; }

        /* --- أزرار التحكم (فوق الدك) --- */
        .controls-container {
            position: fixed; bottom: 85px; left: 0; right: 0; padding: 10px;
            background: linear-gradient(transparent, var(--bg)); z-index: 4000;
        }
        .controls { display: flex; gap: 8px; max-width: 600px; margin: 0 auto; }
        .btn { flex: 1; padding: 12px 5px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.8rem; color: white; }
        
        .btn-ana { background: #1e293b; border: 1px solid var(--c-color); color: var(--c-color); }
        .btn-fix { background: var(--gold); color: #000; }
        .btn-run { background: var(--g-color); color: #000; }
        .btn-clear { background: #ef4444; }

        /* --- الدك السفلي (Floating Dock) --- */
        .dock { 
            position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 400px; height: 65px; background: var(--glass);
            backdrop-filter: blur(15px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-around; align-items: center; z-index: 5000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
        .dock-item { color: #64748b; cursor: pointer; text-align: center; flex: 1; }
        .dock-item i { font-size: 1.4rem; display: block; }
        .dock-item span { font-size: 0.65rem; font-weight: bold; }
        .dock-item.active { color: var(--c-color); }

        /* --- البطاقات --- */
        .overlay { 
            position: fixed; bottom: -100%; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 600px; background: var(--glass);
            backdrop-filter: blur(20px); border: 1px solid var(--p-color);
            border-radius: 25px 25px 0 0; padding: 20px; z-index: 6000;
            box-shadow: 0 -10px 40px #000; max-height: 80vh; overflow-y: auto; transition: 0.5s;
        }
        .overlay.show { bottom: 0; }
        
        #analysis-card { bottom: 50%; transform: translate(-50%, 50%); border-radius: 25px; width: 85%; display: none; }
        #analysis-card.active { display: block; }

        .loader { position: absolute; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 100; border-radius: 20px; }

        #bot-icon { position: fixed; bottom: 160px; left: 20px; width: 50px; height: 50px; background: var(--p-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 3000; cursor: pointer; box-shadow: 0 0 15px var(--p-color); }
    </style>
</head>
<body onload="brython(); initData();">

    <div id="welcome-screen">
        <div class="light-burst"></div>
        <i class="fas fa-robot robot-anim"></i>
        <h1 style="font-size: 3rem; margin: 10px 0;">تِقني AI</h1>
        <p style="color: var(--c-color); font-weight: bold; letter-spacing: 2px;">مستقبلك يبدأ برمز</p>
        <button onclick="launchWorld()" style="margin-top: 30px; padding: 15px 50px; border-radius: 30px; border: 2px solid var(--c-color); background: transparent; color: white; cursor: pointer; font-weight: 900; z-index: 10;">دخول العالم الافتراضي</button>
    </div>

    <div id="main-app">
        <header style="padding: 15px; border-bottom: 1px solid var(--p-color); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3);">
            <b id="nav-title" style="color:var(--gold)">مختبر البرمجة</b>
            <span style="font-size: 0.7rem; opacity: 0.5;">أ. فيصل العريبي</span>
        </header>

        <div class="workspace">
            <div id="ed-box" style="position: relative;">
                <div id="loading-ai" class="loader"><i class="fas fa-pen-nib fa-spin fa-2x" style="color:var(--gold)"></i></div>
                <textarea id="editor" spellcheck="false" placeholder="# اكتب كود بايثون هنا..."></textarea>
            </div>
            <div id="con-box">
                <div id="console"></div>
            </div>
        </div>

        <div class="controls-container">
            <div class="controls">
                <button class="btn btn-ana" onclick="runAnalysis()"><i class="fas fa-brain"></i> تحليل</button>
                <button class="btn btn-fix" onclick="useSmartTeacher()"><i class="fas fa-pen-nib"></i> المعلم</button>
                <button class="btn btn-run" id="run-btn"><i class="fas fa-play"></i> تشغيل</button>
                <button class="btn btn-clear" onclick="clearAll()"><i class="fas fa-trash"></i> مسح</button>
            </div>
        </div>

        <div class="dock">
            <div class="dock-item" onclick="location.reload()"><i class="fas fa-home"></i><span>الرئيسية</span></div>
            <div class="dock-item active" onclick="openLessons()"><i class="fas fa-code-branch"></i><span>الدروس</span></div>
            <div class="dock-item" onclick="openAdmin()"><i class="fas fa-shield-halved"></i><span>الإدارة</span></div>
        </div>
    </div>

    <div id="analysis-card" class="overlay">
        <div style="display: flex; justify-content: space-between; border-bottom: 1px solid #444; padding-bottom: 10px;">
            <b style="color:var(--c-color)">نتائج التحليل الذكي</b>
            <i class="fas fa-times" onclick="closeAnalysis()" style="cursor:pointer"></i>
        </div>
        <div id="analysis-body" style="padding-top:15px; line-height: 1.6; font-size: 0.9rem;"></div>
    </div>

    <div id="lessons-card" class="overlay">
        <h3><i class="fas fa-book"></i> قائمة الدروس</h3>
        <div id="lessons-list"></div>
        <button class="btn" style="background:#333; width:100%; margin-top:10px;" onclick="closeAll()">إغلاق</button>
    </div>

    <div id="acts-card" class="overlay">
        <h3 id="unit-title-ui"></h3>
        <div id="acts-list"></div>
        <button class="btn" style="background:#333; width:100%; margin-top:10px;" onclick="openLessons()">رجوع</button>
    </div>

    <div id="bot-icon" onclick="toggleChat()"><i class="fas fa-robot"></i></div>

    <script type="text/python">
        from browser import document, window
        def run_code(ev):
            document["console"].text = ""
            def log(*args): document["console"].text += " ".join(map(str, args)) + "\n"
            try:
                exec(document["editor"].value, {"print": log, "input": window.prompt})
            except Exception as e:
                document["console"].text = f"خطأ برمجـي:\n{e}"
        document["run-btn"].bind("click", run_code)
    </script>

    <script>
        let activities = [];
        let currentAct = null;

        function initData() {
            const saved = localStorage.getItem('tech_v3_db');
            if(saved) activities = JSON.parse(saved);
            else {
                activities = [
                    { id: 1, unit: 'الوحدة 1', title: 'تحية الروبوت', task: 'اطبع جملة: أنا روبوت ذكي' },
                    { id: 2, unit: 'الوحدة 1', title: 'جمع الأرقام', task: 'اطبع ناتج 10 + 20' }
                ];
                localStorage.setItem('tech_v3_db', JSON.stringify(activities));
            }
        }

        function launchWorld() {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
        }

        function clearAll() {
            if(confirm("هل تريد مسح كل الكود؟")) {
                document.getElementById('editor').value = "";
                document.getElementById('console').innerText = "";
            }
        }

        function closeAll() {
            document.querySelectorAll('.overlay').forEach(o => o.classList.remove('show'));
        }

        function openLessons() {
            closeAll();
            const list = document.getElementById('lessons-list');
            const units = [...new Set(activities.map(a => a.unit))];
            list.innerHTML = units.map(u => `<div style="background:rgba(255,255,255,0.05); padding:15px; margin:10px 0; border-radius:12px; cursor:pointer;" onclick="openActs('${u}')"><i class="fas fa-folder"></i> ${u}</div>`).join('');
            document.getElementById('lessons-card').classList.add('show');
        }

        function openActs(unit) {
            closeAll();
            document.getElementById('unit-title-ui').innerText = unit;
            const list = document.getElementById('acts-list');
            const filtered = activities.filter(a => a.unit === unit);
            list.innerHTML = filtered.map(a => `<div style="background:rgba(255,255,255,0.05); padding:15px; margin:10px 0; border-radius:12px; cursor:pointer;" onclick="startTask(${a.id})">${a.title}</div>`).join('');
            document.getElementById('acts-card').classList.add('show');
        }

        function startTask(id) {
            closeAll();
            currentAct = activities.find(a => a.id === id);
            document.getElementById('nav-title').innerText = currentAct.title;
            document.getElementById('editor').value = `# المهمة: ${currentAct.task}\n\n`;
        }

        async function useSmartTeacher() {
            document.getElementById('loading-ai').style.display = 'flex';
            const res = await fetch('https://text.pollinations.ai/', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({messages: [{role: 'system', content: 'You are a Python Teacher. Fix student code. Return ONLY code.'}, {role: 'user', content: `Task: ${currentAct?.task}\nCode: ${document.getElementById('editor').value}`}]})
            });
            document.getElementById('editor').value = (await res.text()).replace(/```python|```/g, '').trim();
            document.getElementById('loading-ai').style.display = 'none';
        }

        async function runAnalysis() {
            const card = document.getElementById('analysis-card');
            const body = document.getElementById('analysis-body');
            card.style.display = 'block';
            card.classList.add('active');
            body.innerHTML = "جاري تحليل الكود...";
            
            const res = await fetch('https://text.pollinations.ai/', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({messages: [{role: 'system', content: 'حلل الكود واشرحه بتبسيط للطالب.'}, {role: 'user', content: document.getElementById('editor').value}]})
            });
            body.innerText = await res.text();
        }

        function closeAnalysis() {
            document.getElementById('analysis-card').classList.remove('active');
            setTimeout(() => document.getElementById('analysis-card').style.display = 'none', 500);
        }

        function openAdmin() {
            if(prompt("رمز الدخول:") === "1234") {
                alert("لوحة الإدارة قيد التفعيل..");
            }
        }
    </script>
</body>
</html>
