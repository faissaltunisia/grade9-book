<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>تِقني AI | المختبر الذكي</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython_stdlib.min.js"></script>

    <style>
        :root {
            --primary: #4f46e5; --success: #10b981; --bg: #f1f5f9; --editor-dark: #1e293b;
        }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); overflow: hidden; }

        /* الهيكل الرئيسي */
        .app-view { height: 100vh; display: flex; flex-direction: column; }

        /* منطقة المحرر */
        .editor-container { flex: 1; position: relative; background: var(--editor-dark); margin: 10px; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        #editor {
            width: 100%; height: 100%; background: transparent; color: #818cf8;
            padding: 20px; font-family: 'Consolas', monospace; font-size: 1.1rem;
            border: none; outline: none; resize: none; line-height: 1.6; caret-color: white;
        }

        /* شريط التلميحات الذكي (AI Insight) */
        #ai-hint-bar {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: rgba(79, 70, 229, 0.95); backdrop-filter: blur(10px);
            color: white; padding: 12px 20px; font-size: 0.85rem;
            display: flex; align-items: center; gap: 10px;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100; border-top: 1px solid rgba(255,255,255,0.2);
        }
        #ai-hint-bar.visible { transform: translateY(0); }
        .loading-dot { animation: blink 1s infinite; }

        /* منطقة النتائج */
        #output-panel {
            height: 0; background: #000; color: #10b981; transition: 0.3s;
            overflow-y: auto; padding: 0 20px; font-family: monospace; font-size: 0.9rem;
        }
        #output-panel.open { height: 150px; padding: 15px 20px; border-top: 3px solid var(--success); }

        /* شريط التحكم السفلي */
        .nav-bar {
            height: 75px; background: white; display: flex; align-items: center;
            justify-content: space-around; border-top: 1px solid #e2e8f0; z-index: 200;
        }
        .nav-btn { display: flex; flex-direction: column; align-items: center; color: #94a3b8; font-size: 0.7rem; gap: 4px; cursor: pointer; flex: 1; }
        .nav-btn.active { color: var(--primary); }
        .nav-btn i { font-size: 1.3rem; }

        /* زر التشغيل (FAB) */
        .play-fab {
            width: 60px; height: 60px; background: var(--success); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; margin-top: -45px; border: 5px solid white;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3); transition: 0.2s;
        }
        .play-fab:active { transform: scale(0.9); }

        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body onload="brython()">

    <div class="app-view">
        <header style="padding: 15px 20px; background: white; font-weight: 900; color: var(--editor-dark); display: flex; justify-content: space-between; align-items: center;">
            <div>تِقني <span style="color:var(--primary)">AI</span></div>
            <div style="font-size: 0.8rem; background: #eef2ff; color: var(--primary); padding: 5px 12px; border-radius: 20px;">مختبر البرمجة الذكي</div>
        </header>

        <div class="editor-container">
            <textarea id="editor" oninput="debouncedAiHint()" spellcheck="false" placeholder="# ابدأ بكتابة كود بايثون هنا...">print("صلالة الشرقية")</textarea>
            
            <div id="ai-hint-bar">
                <i class="fas fa-robot"></i>
                <span id="hint-content">تِقني يحلل كودك...</span>
            </div>
        </div>

        <div id="output-panel">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #222; padding-bottom: 5px;">
                <span style="color: #666;">نتائج التشغيل</span>
                <i class="fas fa-times" onclick="toggleOutput(false)"></i>
            </div>
            <pre id="console" style="margin: 0; white-space: pre-wrap;"></pre>
        </div>

        <nav class="nav-bar">
            <div class="nav-btn" onclick="clearCode()">
                <i class="fas fa-eraser"></i>
                <span>مسح</span>
            </div>
            
            <div class="play-fab" onclick="runPythonCode()">
                <i class="fas fa-play"></i>
            </div>

            <div class="nav-btn" onclick="toggleOutput(true)">
                <i class="fas fa-terminal"></i>
                <span>النتائج</span>
            </div>
        </nav>
    </div>

    <script type="text/python">
        from browser import document, window

        def run_code(ev=None):
            # فتح لوحة النتائج تلقائياً عند التشغيل
            window.toggleOutput(True)
            document["console"].text = ""
            
            def custom_print(*args):
                document["console"].text += " ".join(map(str, args)) + "\n"
            
            code = document["editor"].value
            try:
                exec(code, {"print": custom_print, "input": window.prompt})
            except Exception as e:
                document["console"].text = f"❌ خطأ:\n{str(e)}"

        # ربط الوظيفة بالنافذة لتكون متاحة للـ JavaScript
        window.runPythonCode = run_code
    </script>

    <script>
        let hintTimeout;

        // وظيفة تشغيل الكود (تستدعي Brython)
        function runPythonCode() {
            if (window.runPythonCode) {
                window.runPythonCode();
            }
        }

        // إظهار/إخفاء لوحة النتائج
        function toggleOutput(show) {
            const panel = document.getElementById('output-panel');
            if (show) panel.classList.add('open');
            else panel.classList.remove('open');
        }

        function clearCode() {
            if (confirm("هل تريد مسح منطقة العمل؟")) {
                document.getElementById('editor').value = "";
                document.getElementById('console').innerText = "";
            }
        }

        // استدعاء الذكاء الاصطناعي للتلميحات (خارجي)
        async function getAiHint() {
            const code = document.getElementById('editor').value;
            const hintBar = document.getElementById('ai-hint-bar');
            const hintContent = document.getElementById('hint-content');

            if (code.length < 5) {
                hintBar.classList.remove('visible');
                return;
            }

            hintBar.classList.add('visible');
            hintContent.innerHTML = 'تِقني يفكر <span class="loading-dot">...</span>';

            try {
                const response = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'أنت مساعد برمجي ذكي جداً ومختصر. حلل كود بايثون التالي وأعطِ نصيحة في جملة واحدة فقط لا تزيد عن 7 كلمات باللغة العربية.' },
                            { role: 'user', content: code }
                        ]
                    })
                });
                const data = await response.text();
                hintContent.innerText = "تِقني: " + data;
            } catch (error) {
                hintContent.innerText = "تِقني: واصل الكتابة، أنت على الطريق الصحيح!";
            }
        }

        // تأخير الاستدعاء لضمان عدم إرهاق السيرفر أثناء الكتابة السريعة
        function debouncedAiHint() {
            clearTimeout(hintTimeout);
            hintTimeout = setTimeout(getAiHint, 2000); // يحلل الكود بعد توقف الطالب عن الكتابة بـثانيتين
        }
    </script>
</body>
</html>
