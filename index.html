<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© ØªÙÙ‚Ù†ÙŠ Ø§Ù„Ø°ÙƒÙŠØ© | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython_stdlib.min.js"></script>

    <style>
        :root { --primary: #0062ff; --danger: #ff4757; --bg: #0f172a; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); overflow: hidden; color: white; }

        .main-layout { display: flex; flex-direction: column; height: 100vh; }
        
        /* Ø§Ù„Ù…Ø­Ø±Ø± */
        .editor-container { flex: 1; position: relative; background: #1e1e1e; }
        #editor {
            width: 100%; height: 100%; background: transparent; color: #7dd3fc;
            padding: 25px; font-family: 'Consolas', monospace; font-size: 1.2rem;
            border: none; outline: none; resize: none; line-height: 1.8;
        }

        /* --- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ ÙˆØ§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© --- */
        #floating-assistant {
            position: absolute; left: 15px; right: 15px;
            display: flex; flex-direction: column; gap: 8px;
            pointer-events: none; transition: top 0.2s ease; z-index: 1000;
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØµÙŠØ­Ø© */
        .hint-card {
            background: rgba(0, 98, 255, 0.9); padding: 8px 15px;
            border-radius: 10px; font-size: 0.85rem; font-weight: bold;
            display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³Ø­ */
        .edit-tools {
            display: flex; gap: 10px; pointer-events: auto;
        }
        .tool-btn {
            padding: 8px 15px; border: none; border-radius: 8px; 
            font-size: 0.8rem; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 5px; color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.2s;
        }
        .clear-all { background: var(--danger); }
        .backspace { background: #4b5563; }
        .tool-btn:active { transform: scale(0.9); }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-bar { background: #1e293b; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #334155; }
        .main-btn { flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: 900; cursor: pointer; font-size: 1rem; }
        .btn-run { background: #22c55e; color: white; }
        .btn-ai { background: var(--primary); color: white; }

        #terminal { height: 80px; background: #000; padding: 10px; color: #22c55e; font-family: monospace; overflow-y: auto; font-size: 0.85rem; }
    </style>
</head>
<body onload="brython()">

    <div class="main-layout">
        <div style="padding: 10px 20px; background: #1e293b; border-bottom: 1px solid #333;">
            <strong style="color:var(--primary)">Ù…Ø®ØªØ¨Ø± ØªÙÙ‚Ù†ÙŠ Ø§Ù„Ø°ÙƒÙŠ ğŸ¤–</strong>
        </div>

        <div class="editor-container">
            <div id="floating-assistant">
                <div class="hint-card">
                    <i class="fas fa-magic"></i>
                    <span id="hint-msg">ØªÙÙ‚Ù†ÙŠ: Ø¬Ø§Ù‡Ø² Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ!</span>
                </div>
                <div class="edit-tools">
                    <button class="tool-btn backspace" onclick="deleteChar()">
                        <i class="fas fa-backspace"></i> Ù…Ø³Ø­ Ø­Ø±Ù
                    </button>
                    <button class="tool-btn clear-all" onclick="clearFullCode()">
                        <i class="fas fa-trash-alt"></i> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                    </button>
                </div>
            </div>

            <textarea id="editor" oninput="updateAssistant()" onkeyup="updateAssistant()" onclick="updateAssistant()" spellcheck="false">print("Ù…Ø±Ø­Ø¨Ø§Ù‹")</textarea>
        </div>

        <div id="terminal">>>> Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>

        <div class="bottom-bar">
            <button class="main-btn btn-run" id="run_btn"><i class="fas fa-play"></i> ØªØ´ØºÙŠÙ„</button>
            <button class="main-btn btn-ai" onclick="alert('Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯...')"><i class="fas fa-robot"></i> Ù…Ø³Ø§Ø¹Ø¯Ø© ØªÙÙ‚Ù†ÙŠ</button>
        </div>
    </div>

    <script type="text/python">
        from browser import document, window
        def run_code(ev):
            document["terminal"].text = ""
            def log(*args): document["terminal"].text += " ".join(map(str, args)) + "\n"
            try:
                exec(document["editor"].value, {"print": log, "input": window.prompt})
            except Exception as e:
                document["terminal"].text = f"Ø®Ø·Ø£: {e}"
        document["run_btn"].bind("click", run_code)
    </script>

    <script>
        function updateAssistant() {
            const editor = document.getElementById('editor');
            const floating = document.getElementById('floating-assistant');
            const hint = document.getElementById('hint-msg');
            const code = editor.value;

            // Ø­Ø³Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù…Ù„Ø§Ø­Ù‚Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
            const lines = code.substr(0, editor.selectionStart).split("\n");
            const currentLine = lines.length;
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„ØªÙƒÙˆÙ† Ø£Ø³ÙÙ„ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
            let topPos = (currentLine * 30) + 40;
            if (topPos > editor.offsetHeight - 100) topPos = editor.offsetHeight - 120; // Ù…Ù†Ø¹ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù† Ø§Ù„Ø´Ø§Ø´Ø©
            floating.style.top = topPos + "px";

            // Ù†ØµØ§Ø¦Ø­ Ø³Ø±ÙŠØ¹Ø©
            if (code.includes('print') && !code.includes('(')) {
                hint.innerText = "ØªÙÙ‚Ù†ÙŠ: Ù„Ø§ ØªÙ†Ø³Ù ÙØªØ­ Ø§Ù„Ù‚ÙˆØ³ (";
            } else if (code.includes('(') && !code.includes(')')) {
                hint.innerText = "ØªÙÙ‚Ù†ÙŠ: Ø£ØºÙ„Ù‚ Ø§Ù„Ù‚ÙˆØ³ ) Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯";
            } else {
                hint.innerText = "ØªÙÙ‚Ù†ÙŠ: Ø§Ø³ØªÙ…Ø±ØŒ Ø£Ù†Øª Ù…Ø¨Ø¯Ø¹!";
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø­ Ø­Ø±Ù ÙˆØ§Ø­Ø¯
        function deleteChar() {
            const editor = document.getElementById('editor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;

            if (start === end && start > 0) {
                editor.value = text.substring(0, start - 1) + text.substring(end);
                editor.selectionStart = editor.selectionEnd = start - 1;
            } else {
                editor.value = text.substring(0, start) + text.substring(end);
            }
            editor.focus();
            updateAssistant();
        }

        // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ ØªØ£ÙƒÙŠØ¯
        function clearFullCode() {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„ÙƒÙˆØ¯ØŸ")) {
                document.getElementById('editor').value = "";
                document.getElementById('editor').focus();
                updateAssistant();
            }
        }
    </script>
</body>
</html>
