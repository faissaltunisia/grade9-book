<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªÙÙ‚Ù†ÙŠ Ø§Ù„Ø°ÙƒÙŠ | Ù†Ø³Ø®Ø© Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython_stdlib.min.js"></script>

    <style>
        :root { --primary: #4f46e5; --ai-bg: #eff6ff; --dark-blue: #1e293b; --success: #10b981; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Ù…Ù†Ø¹ Ø§Ù„ØµÙØ­Ø© Ù…Ù† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø«Ø¨Ø§Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ */
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background: #f8fafc; }

        .app-container {
            display: flex; flex-direction: column; height: 100vh; /* ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ÙƒØ§Ù…Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø´Ø§Ø´Ø© */
        }

        /* 1. Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰) */
        .ai-observer {
            height: 55px; background: var(--ai-bg); border-bottom: 2px solid #dbeafe;
            display: flex; align-items: center; padding: 0 12px; gap: 10px; flex-shrink: 0;
            z-index: 100;
        }
        .ai-pulse { width: 10px; height: 10px; background: var(--primary); border-radius: 50%; animation: pulse 1.5s infinite; }
        .ai-status-text { font-size: 0.8rem; font-weight: 700; color: #1e40af; flex: 1; }

        /* 2. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ (Ø§Ù„Ù…Ø­Ø±Ø± + Ø§Ù„Ù†ØªØ§Ø¦Ø¬) */
        .work-area {
            flex: 1; display: flex; flex-direction: column; overflow: hidden; background: var(--dark-blue);
        }

        /* Ø§Ù„Ù…Ø­Ø±Ø± ÙŠØªÙ‚Ù„Øµ Ø¨Ù…Ø±ÙˆÙ†Ø© Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ */
        #editor-wrapper { flex: 1; min-height: 150px; position: relative; }
        #editor {
            width: 100%; height: 100%; background: transparent; color: #67e8f9;
            padding: 15px; font-family: 'Consolas', monospace; font-size: 1rem;
            border: none; outline: none; resize: none; line-height: 1.4;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªØ£Ø®Ø° Ù…Ø³Ø§Ø­Ø© Ø«Ø§Ø¨ØªØ© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ */
        .console-wrapper {
            height: 120px; background: #000; border-top: 2px solid #334155;
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        .console-tab { background: #111; color: #555; font-size: 0.65rem; padding: 4px 12px; font-weight: bold; }
        #console { flex: 1; padding: 8px 12px; color: var(--success); font-family: monospace; overflow-y: auto; font-size: 0.85rem; }

        /* 3. Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³ÙÙ„ÙŠ (Ø«Ø§Ø¨Øª) */
        .controls {
            height: 70px; background: white; border-top: 1px solid #e2e8f0;
            display: flex; align-items: center; padding: 0 10px; gap: 8px; flex-shrink: 0;
        }
        .btn { border: none; border-radius: 12px; font-weight: 900; font-size: 0.85rem; display: flex; align-items: center; justify-content: center; gap: 6px; cursor: pointer; }
        .btn-run { flex: 2; height: 48px; background: var(--success); color: white; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.2); }
        .btn-chat { flex: 1; height: 48px; background: var(--primary); color: white; }
        .btn-clear { width: 48px; height: 48px; background: #f1f5f9; color: #64748b; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ */
        #chat-window { position: fixed; inset: 0; background: white; z-index: 1000; display: none; flex-direction: column; }
        .chat-msg-area { flex: 1; padding: 15px; overflow-y: auto; background: #f8fafc; display: flex; flex-direction: column; gap: 12px; }
        .bubble { padding: 12px; border-radius: 15px; max-width: 85%; font-size: 0.9rem; line-height: 1.5; }
        .ai-msg { background: var(--ai-bg); border-right: 4px solid var(--primary); align-self: flex-start; }
        .user-msg { background: var(--primary); color: white; align-self: flex-end; }
        
        .chat-input-bar { padding: 12px; border-top: 1px solid #eee; display: flex; gap: 8px; }
        #chat-input { flex: 1; border: 1px solid #ddd; border-radius: 10px; padding: 10px; outline: none; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
    </style>
</head>
<body onload="brython()">

    <div class="app-container">
        <div class="ai-observer">
            <div class="ai-pulse"></div>
            <div class="ai-status-text" id="ai-observer-text">ØªÙÙ‚Ù†ÙŠ: Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ Ø£Ø±Ø§Ù‚Ø¨ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø¢Ù† Ù„ØªÙˆØ¬ÙŠÙ‡Ùƒ.</div>
            <i class="fas fa-robot" style="color: var(--primary)"></i>
        </div>

        <main class="work-area">
            <div id="editor-wrapper">
                <textarea id="editor" spellcheck="false" oninput="monitorProgress()"># Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù‡Ù†Ø§
print("Ù…Ø±Ø­Ø¨Ø§Ù‹")</textarea>
            </div>

            <div class="console-wrapper">
                <div class="console-tab">Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª</div>
                <div id="console"></div>
            </div>
        </main>

        <footer class="controls">
            <button class="btn btn-clear" onclick="clearCode()"><i class="fas fa-eraser"></i></button>
            <button class="btn btn-run" onclick="runCode()">
                <i class="fas fa-play"></i> â–¶ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
            </button>
            <button class="btn btn-chat" onclick="toggleChat(true)">
                <i class="fas fa-brain"></i> ØªØ­Ù„ÙŠÙ„
            </button>
        </footer>
    </div>

    <div id="chat-window">
        <div style="padding:15px; background:var(--primary); color:white; display:flex; justify-content:space-between; align-items:center;">
            <strong><i class="fas fa-robot"></i> ØªØ­Ù„ÙŠÙ„ ØªÙÙ‚Ù†ÙŠ Ø§Ù„Ø°ÙƒÙŠ</strong>
            <i class="fas fa-times" onclick="toggleChat(false)" style="font-size:1.4rem;"></i>
        </div>
        <div class="chat-msg-area" id="chat-box">
            <div class="bubble ai-msg">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! ÙŠÙ…ÙƒÙ†Ù†ÙŠ ØªØ­Ù„ÙŠÙ„ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø¢Ù† ÙˆØ¥Ø®Ø¨Ø§Ø±Ùƒ Ø¨Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø¶Ø¹Ù ÙÙŠÙ‡. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø¡ØŸ</div>
        </div>
        <div class="chat-input-bar">
            <button onclick="analyzeCodeRequested()" style="background:#f59e0b; color:white; border:none; padding:10px; border-radius:10px; font-weight:bold; font-size:0.75rem;">Ø­Ù„Ù„ ÙƒÙˆØ¯ÙŠ Ø§Ù„Ø¢Ù† âœ¨</button>
            <input type="text" id="chat-input" placeholder="Ø§Ø³Ø£Ù„ Ø¹Ù† Ø¯Ø±Ø³ Ø§Ù„ÙŠÙˆÙ…...">
            <button onclick="sendUserChat()" style="background:var(--primary); color:white; border:none; border-radius:10px; width:40px;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script type="text/python">
        from browser import document, window
        def execute(ev=None):
            document["console"].text = ""
            def log(*args): document["console"].text += " ".join(map(str, args)) + "\n"
            try:
                exec(document["editor"].value, {"print": log, "input": window.prompt})
                window.observerUpdate("success")
            except Exception as e:
                document["console"].text = f"âŒ Ø®Ø·Ø£:\n{str(e)}"
                window.observerUpdate("error")
        window.pyRun = execute
    </script>

    <script>
        // 1. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ)
        function monitorProgress() {
            const code = document.getElementById('editor').value;
            const status = document.getElementById('ai-observer-text');
            
            if (code.includes('print') && !code.includes('(')) {
                status.innerText = "ØªÙÙ‚Ù†ÙŠ: ØªØ°ÙƒØ± ÙˆØ¶Ø¹ Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ () ÙÙŠ Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.";
            } else if (code.length > 30) {
                status.innerText = "ØªÙÙ‚Ù†ÙŠ: ÙƒÙˆØ¯Ùƒ Ø¨Ø¯Ø£ ÙŠÙƒØ¨Ø±! Ù‡Ù„ Ø¬Ø±Ø¨Øª ØªØ´ØºÙŠÙ„Ù‡ØŸ";
            } else {
                status.innerText = "ØªÙÙ‚Ù†ÙŠ: ÙƒÙˆØ¯Ùƒ Ù†Ø¸ÙŠÙ ÙˆÙ…Ù†Ø¸Ù…ØŒ Ø§Ø³ØªÙ…Ø±!";
            }
        }

        function observerUpdate(type) {
            const status = document.getElementById('ai-observer-text');
            status.innerText = (type === "success") ? "ØªÙÙ‚Ù†ÙŠ: Ø±Ø§Ø¦Ø¹! Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­." : "ØªÙÙ‚Ù†ÙŠ: Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ØŒ Ø§ÙØªØ­ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ.";
        }

        // 2. ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨)
        function toggleChat(show) { document.getElementById('chat-window').style.display = show ? 'flex' : 'none'; }

        async function analyzeCodeRequested() {
            const code = document.getElementById('editor').value;
            addMsg('user', "Ø­Ù„Ù„ Ù„ÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† ÙØ¶Ù„Ùƒ.");
            const loadingId = addMsg('ai', "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ... ğŸ› ï¸");

            try {
                const res = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        messages: [
                            {role: 'system', content: 'Ø£Ù†Øª ØªÙÙ‚Ù†ÙŠØŒ Ù…Ø¹Ù„Ù… Ø¹Ù…Ø§Ù†ÙŠ. Ø­Ù„Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: Ø§Ø´Ø±Ø­ Ù…Ø§ ÙŠÙØ¹Ù„Ù‡ Ø§Ù„ÙƒÙˆØ¯ØŒ ÙˆÙ‡Ù„ Ù‡Ù†Ø§Ùƒ Ø£Ø®Ø·Ø§Ø¡ØŒ ÙˆÙ‚Ø¯Ù… Ù†ØµÙŠØ­Ø© ØªØ·ÙˆÙŠØ±ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø´ÙƒÙ„ Ù…Ø®ØªØµØ± Ø¬Ø¯Ø§Ù‹.'},
                            {role: 'user', content: code}
                        ]
                    })
                });
                const text = await res.text();
                document.getElementById(loadingId).innerText = text;
            } catch {
                document.getElementById(loadingId).innerText = "Ø¹Ø°Ø±Ø§Ù‹ ÙŠØ§ Ø¨Ø·Ù„ØŒ ÙˆØ§Ø¬Ù‡Øª Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„!";
            }
        }

        function addMsg(role, text) {
            const box = document.getElementById('chat-box');
            const id = 'msg-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'bubble ' + (role === 'ai' ? 'ai-msg' : 'user-msg');
            div.innerText = text;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
            return id;
        }

        function runCode() { window.pyRun(); }
        function clearCode() { if(confirm("Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ØŸ")) document.getElementById('editor').value = ""; }
    </script>
</body>
</html>
