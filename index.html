<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>منصة تِقني AI | أ. فيصل العريبي</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython_stdlib.min.js"></script>

    <style>
        :root {
            --neon-purple: #a855f7;
            --neon-cyan: #22d3ee;
            --dark-bg: #030712;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100vw; background: var(--dark-bg); color: white; overflow: hidden; display: flex; flex-direction: column; }

        header { height: 60px; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3); border-bottom: 1px solid var(--neon-purple); }

        .workspace { flex: 1; display: flex; flex-direction: column; padding: 10px; gap: 10px; position: relative; }
        #editor { flex: 1; background: #010409; color: #79c0ff; padding: 15px; border-radius: 12px; border: 1px solid var(--glass); font-family: monospace; font-size: 1.1rem; outline: none; resize: none; }
        
        #console { height: 120px; background: #000; color: #10b981; padding: 15px; border-radius: 12px; border: 1px solid rgba(168, 85, 247, 0.2); overflow-y: auto; font-family: monospace; }

        /* --- أيقونة المساعد الروبوت العائمة --- */
        #ai-chat-trigger {
            position: fixed; bottom: 100px; left: 20px; width: 60px; height: 60px;
            background: linear-gradient(135deg, var(--neon-purple), #6366f1);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; color: white; cursor: pointer; z-index: 1000;
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.5); border: 2px solid rgba(255,255,255,0.2);
            animation: pulse 2s infinite;
        }

        /* --- نافذة الدردشة المستقلة --- */
        #chat-window {
            position: fixed; bottom: 170px; left: 20px; width: 320px; height: 450px;
            max-width: 85vw; max-height: 60vh; background: #0f172a; border: 1px solid var(--neon-purple);
            border-radius: 20px; display: none; flex-direction: column; z-index: 2000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); overflow: hidden;
            animation: slideIn 0.3s ease-out;
        }

        .chat-header { padding: 15px; background: var(--neon-purple); display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; font-size: 0.9rem; background: #020617; }
        .msg-bot { background: var(--glass); padding: 10px; border-radius: 15px 15px 15px 0; border: 1px solid rgba(168, 85, 247, 0.2); align-self: flex-start; max-width: 85%; }
        .msg-user { background: var(--neon-purple); color: white; padding: 10px; border-radius: 15px 15px 0 15px; align-self: flex-end; max-width: 85%; }
        
        .chat-input-area { padding: 10px; background: #0f172a; display: flex; gap: 8px; border-top: 1px solid var(--glass); }
        .chat-input-area input { flex: 1; background: #1e293b; border: none; padding: 10px; border-radius: 10px; color: white; outline: none; }
        .chat-input-area button { background: var(--neon-purple); border: none; width: 40px; border-radius: 10px; color: white; cursor: pointer; }

        footer { height: 80px; background: #0f172a; display: flex; align-items: center; padding: 0 10px; gap: 10px; border-top: 1px solid var(--glass); }
        .btn { height: 50px; border-radius: 10px; border: none; color: white; font-weight: bold; flex: 1; cursor: pointer; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(168, 85, 247, 0); } 100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body onload="brython()">

    <header>
        <div style="font-weight: 900; font-size: 1.2rem;">تِقني <span style="color:var(--neon-cyan)">AI</span></div>
        <div style="font-size: 0.8rem; opacity: 0.7;">أ. فيصل العريبي</div>
    </header>

    <div class="workspace">
        <textarea id="editor" spellcheck="false" placeholder="اكتب كودك هنا..."></textarea>
        <div id="console"></div>
    </div>

    <div id="ai-chat-trigger" onclick="toggleChat()">
        <i class="fas fa-robot"></i>
    </div>

    <div id="chat-window" id="chatWindow">
        <div class="chat-header">
            <span><i class="fas fa-brain"></i> مساعد تِقني الذكي</span>
            <i class="fas fa-times" onclick="toggleChat()" style="cursor:pointer"></i>
        </div>
        <div class="chat-messages" id="chatMsgs">
            <div class="msg-bot">أهلاً بك! أنا تِقني، مساعد الأستاذ فيصل العريبي. كيف يمكنني مساعدتك في فهم البرمجة اليوم؟</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="userInput" placeholder="اسأل تِقني..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <footer>
        <button class="btn" style="background:#334155;" onclick="document.getElementById('editor').value=''">مسح</button>
        <button class="btn" style="background:#10b981; flex: 2;" onclick="window.run_it()">تشغيل البرنامج</button>
        <button class="btn" style="background:var(--neon-purple);" onclick="toggleChat()">اسأل تِقني</button>
    </footer>

    <script type="text/python">
        from browser import document, window
        def execute_py(ev=None):
            document["console"].text = ""
            def log(*args): document["console"].text += " ".join(map(str, args)) + "\n"
            try:
                exec(document["editor"].value, {"print": log, "input": window.prompt})
            except Exception as e:
                document["console"].text = f"خطأ برمي:\n{str(e)}"
        window.run_it = execute_py
    </script>

    <script>
        function toggleChat() {
            const win = document.getElementById('chat-window');
            win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const msgs = document.getElementById('chatMsgs');
            if(!input.value.trim()) return;

            const userText = input.value;
            msgs.innerHTML += `<div class="msg-user">${userText}</div>`;
            input.value = "";
            msgs.scrollTop = msgs.scrollHeight;

            // استجابة الذكاء الاصطناعي
            const loadingId = "load-" + Date.now();
            msgs.innerHTML += `<div class="msg-bot" id="${loadingId}">... جاري التفكير</div>`;
            
            try {
                const res = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        messages: [
                            {role: 'system', content: 'أنت تِقني، مساعد ذكي للأستاذ فيصل العريبي. ساعد الطالب في فهم لغة بايثون والبرمجة بوضوح واحترام.'},
                            {role: 'user', content: userText}
                        ]
                    })
                });
                const data = await res.text();
                document.getElementById(loadingId).innerText = data;
            } catch {
                document.getElementById(loadingId).innerText = "عذراً، واجهت مشكلة في الاتصال.";
            }
            msgs.scrollTop = msgs.scrollHeight;
        }
    </script>
</body>
</html>
