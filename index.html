<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© | Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ·ÙˆØ±</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython_stdlib.min.js"></script>

    <style>
        :root {
            --primary: #004a99; --accent: #d92027; --ai-color: #00d2ff;
            --glass: rgba(255, 255, 255, 0.95); --dark-panel: #1e1e1e;
        }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #f0f2f5; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        #welcome-screen {
            position: fixed; inset: 0; background: linear-gradient(135deg, #001a33, #000);
            z-index: 10000; display: flex; align-items: center; justify-content: center; color: white; text-align: center;
        }

        /* Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .app-container { display: flex; flex-direction: column; height: 100vh; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        header {
            background: white; padding: 10px 15px; display: flex; justify-content: space-between;
            align-items: center; border-bottom: 2px solid #eee; z-index: 100;
        }
        .header-btns { display: flex; gap: 8px; }
        .btn { border: none; padding: 8px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.85rem; }
        .btn-run { background: #00c853; color: white; }
        .btn-magic { background: #6200ea; color: white; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .content-area { flex: 1; position: relative; overflow: hidden; }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ø§Ù„Ù…Ø­Ø±Ø±ØŒ Ø§Ù„Ø¯Ø±ÙˆØ³ØŒ Ø§Ù„ÙƒØªØ§Ø¨) */
        .page-view { position: absolute; inset: 0; background: white; display: none; flex-direction: column; padding: 10px; }
        .page-view.active { display: flex; }

        /* Ø§Ù„Ù…Ø­Ø±Ø± */
        #editor {
            flex: 1; background: var(--dark-panel); color: #00ff41; padding: 15px;
            border-radius: 15px; font-family: monospace; font-size: 1rem; border: none; outline: none;
        }
        .terminal { height: 100px; background: #000; color: #fff; margin-top: 8px; border-radius: 12px; padding: 10px; font-size: 0.8rem; overflow-y: auto; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© (Ù„Ù„Ù‡Ø§ØªÙ) */
        .bottom-nav {
            background: white; height: 70px; display: flex; justify-content: space-around;
            align-items: center; border-top: 1px solid #ddd; padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #777; font-size: 0.7rem; gap: 4px; cursor: pointer; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item i { font-size: 1.3rem; }

        /* ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        #ai-capsule {
            position: fixed; bottom: 85px; left: 15px; width: 55px; height: 55px;
            background: var(--ai-color); border-radius: 50%; display: flex;
            align-items: center; justify-content: center; color: white; font-size: 1.4rem;
            box-shadow: 0 4px 15px rgba(0,210,255,0.4); z-index: 999;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ */
        #ai-window {
            position: fixed; bottom: 150px; left: 15px; right: 15px; top: 100px;
            background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none; flex-direction: column; z-index: 1000; overflow: hidden;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ÙƒØªØ§Ø¨ (ØªØ¸Ù‡Ø± ÙƒØ¥Ø´Ø¹Ø§Ø± Ø¹Ù„ÙˆÙŠ) */
        #book-overlay {
            position: absolute; top: -100%; left: 0; right: 0; height: 80%;
            background: var(--glass); backdrop-filter: blur(10px); z-index: 500;
            transition: 0.4s; border-bottom: 3px solid var(--primary); padding: 20px;
        }
        #book-overlay.active { top: 0; }

        /* Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© */
        #smart-toast {
            position: fixed; top: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: #00ff41; padding: 10px 20px;
            border-radius: 50px; font-size: 0.8rem; z-index: 2000; display: none;
        }
    </style>
</head>
<body onload="brython()">

    <div id="welcome-screen">
        <div>
            <img src="https://upload.wikimedia.org/wikipedia/commons/d/dd/Oman_National_Emblem.svg" width="80">
            <h2>Ù…Ø®ØªØ¨Ø± ØªÙÙ‚Ù†ÙŠ Ø§Ù„Ø°ÙƒÙŠ</h2>
            <button class="btn" style="background:var(--accent); color:white; padding:15px 40px; margin-top:20px;" onclick="start()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø®ØªØ¨Ø±</button>
        </div>
    </div>

    <div class="app-container">
        <header>
            <strong>ØªÙÙ‚Ù†ÙŠ <span style="color:var(--ai-color)">AI</span></strong>
            <div class="header-btns">
                <button class="btn btn-magic" onclick="askAIAboutCode()"><i class="fa-solid fa-wand-magic-sparkles"></i> Ø³Ø­Ø±</button>
                <button class="btn btn-run" id="run_btn"><i class="fa-solid fa-play"></i> ØªØ´ØºÙŠÙ„</button>
            </div>
        </header>

        <div class="content-area">
            <div id="smart-toast">ØªÙÙ‚Ù†ÙŠ ÙŠØ±Ø§Ù‚Ø¨...</div>

            <div id="view-editor" class="page-view active">
                <textarea id="editor" spellcheck="false" oninput="analyzeCodeLive()" placeholder="# Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ Ø¨Ø§ÙŠØ«ÙˆÙ† Ù‡Ù†Ø§..."></textarea>
                <div class="terminal" id="output">>>> Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
            </div>

            <div id="view-lessons" class="page-view">
                <h3>Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h3>
                <div style="background:#f8f9fa; padding:15px; border-radius:15px; margin-bottom:10px; border-right:5px solid var(--primary);" onclick="loadLesson('print(\'Ù…Ø±Ø­Ø¨Ø§Ù‹\')', 'Ø¯Ø±Ø³ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©')">
                    <strong>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</strong><br><small>ØªØ¹Ù„Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</small>
                </div>
                <div style="background:#f8f9fa; padding:15px; border-radius:15px; border-right:5px solid var(--accent);" onclick="loadLesson('x = 5\nprint(x)', 'Ø¯Ø±Ø³ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª')">
                    <strong>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</strong><br><small>Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</small>
                </div>
            </div>

            <div id="view-awards" class="page-view" style="text-align:center;">
                <i class="fa-solid fa-trophy" style="font-size:4rem; color:gold; margin-top:30px;"></i>
                <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
                <p>Ø£Ù†Ù‡Ù Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø£ÙˆØ³Ù…ØªÙƒ Ù‡Ù†Ø§!</p>
            </div>

            <div id="book-overlay">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3>ğŸ“– Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</h3>
                    <button onclick="toggleBook()" style="border:none; background:none; font-size:1.5rem;">&times;</button>
                </div>
                <div style="height:90%; overflow-y:auto; padding-top:10px;">
                    <iframe src="https://www.moe.gov.om/Portals/0/Information%20Technology%20Grade%209.pdf" style="width:100%; height:100%; border:none; border-radius:10px;"></iframe>
                </div>
            </div>
        </div>

        <div id="ai-capsule" onclick="toggleAIWindow()">
            <i class="fa-solid fa-robot"></i>
        </div>

        <div id="ai-window">
            <div style="background:var(--primary); color:white; padding:15px; display:flex; justify-content:space-between;">
                <span>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ ØªÙÙ‚Ù†ÙŠ</span>
                <i class="fa-solid fa-times" onclick="toggleAIWindow()"></i>
            </div>
            <div id="chat-flow" style="flex:1; padding:15px; overflow-y:auto; display:flex; flex-direction:column; gap:10px; background:#f4f7fa;">
                <div style="background:white; padding:10px; border-radius:10px; font-size:0.9rem;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø·Ù„ ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©! Ø£Ù†Ø§ Ø£Ø±Ø§Ù‚Ø¨ ÙƒÙˆØ¯Ùƒ ÙˆØ³Ø£ÙˆØ¬Ù‡Ùƒ Ù„Ù„Ø­Ù„ Ø§Ù„ØµØ­ÙŠØ­.</div>
            </div>
            <div style="padding:10px; background:white; display:flex; gap:10px; border-top:1px solid #eee;">
                <input type="text" id="ai-input" placeholder="Ø§Ø³Ø£Ù„ ØªÙÙ‚Ù†ÙŠ..." style="flex:1; border:1px solid #ddd; padding:10px; border-radius:10px;">
                <button onclick="sendAI()" style="background:var(--primary); color:white; border:none; padding:10px; border-radius:10px;"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" id="nav-editor" onclick="switchView('view-editor', this)">
                <i class="fa-solid fa-code"></i><span>Ø§Ù„Ù…Ø­Ø±Ø±</span>
            </div>
            <div class="nav-item" onclick="switchView('view-lessons', this)">
                <i class="fa-solid fa-layer-group"></i><span>Ø§Ù„ÙˆØ­Ø¯Ø§Øª</span>
            </div>
            <div class="nav-item" onclick="toggleBook()">
                <i class="fa-solid fa-book-open"></i><span>Ø§Ù„ÙƒØªØ§Ø¨</span>
            </div>
            <div class="nav-item" onclick="switchView('view-awards', this)">
                <i class="fa-solid fa-award"></i><span>Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</span>
            </div>
        </nav>
    </div>

    <script type="text/python">
        from browser import document, window
        def run_it(ev):
            document["output"].text = ""
            def log(*args): document["output"].text += " ".join(map(str, args)) + "\n"
            try:
                exec(document["editor"].value, {"print": log, "input": window.prompt})
                window.notifyAI("Ø£Ø­Ø³Ù†Øª! Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­")
            except Exception as e:
                document["output"].text = f"Ø®Ø·Ø£: {e}"
                window.notifyAI("Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ø¥ØµÙ„Ø§Ø­Ù‡ Ø£Ùˆ Ø§Ø¶ØºØ· 'Ø³Ø­Ø±'")
        document["run_btn"].bind("click", run_it)
    </script>

    <script>
        function start() { document.getElementById('welcome-screen').style.display = 'none'; }

        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
        function switchView(viewId, el) {
            document.querySelectorAll('.page-view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            el.classList.add('active');
        }

        // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨ (Ù…Ø«Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ)
        function toggleBook() {
            document.getElementById('book-overlay').classList.toggle('active');
        }

        function toggleAIWindow() {
            const win = document.getElementById('ai-window');
            win.style.display = (win.style.display === 'flex') ? 'none' : 'flex';
        }

        // Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ù„Ù„ÙƒÙˆØ¯ (ØªÙØ§Ø¹Ù„ Ù„Ø­Ø¸ÙŠ)
        function analyzeCodeLive() {
            const code = document.getElementById('editor').value;
            const toast = document.getElementById('smart-toast');
            
            if (code.includes('print') && !code.includes('(')) {
                toast.innerText = "ØªÙÙ‚Ù†ÙŠ: ØªØ°ÙƒØ± Ø§Ù„Ø£Ù‚ÙˆØ§Ø³ () Ø¨Ø¹Ø¯ ÙƒÙ„Ù…Ø© print";
                toast.style.display = 'block';
            } else if (code.includes('"') && (code.match(/"/g) || []).length % 2 !== 0) {
                toast.innerText = "ØªÙÙ‚Ù†ÙŠ: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªÙ†ØµÙŠØµ \"";
                toast.style.display = 'block';
            } else {
                toast.style.display = 'none';
            }
        }

        window.notifyAI = function(msg) {
            const toast = document.getElementById('smart-toast');
            toast.innerText = "ØªÙÙ‚Ù†ÙŠ: " + msg;
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        };

        // Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ© (Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„ÙƒÙˆØ¯)
        async function askAIAboutCode() {
            const code = document.getElementById('editor').value;
            toggleAIWindow();
            addChat("user", "Ø­Ù„Ù„ ÙƒÙˆØ¯ÙŠ ÙˆØµØ­Ø­Ù‡ Ù„ÙŠ:\n" + code);
            const loading = addChat("ai", "ØªÙÙ‚Ù†ÙŠ ÙŠØ­Ù„Ù„ Ø§Ù„ÙƒÙˆØ¯... âœï¸");
            
            try {
                const res = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        messages: [
                            {role: 'system', content: 'Ø£Ù†Øª ØªÙÙ‚Ù†ÙŠ Ù…Ø¹Ù„Ù… Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©. Ø­Ù„Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ£Ø¹Ø·Ù‡ Ù†ØµØ§Ø¦Ø­ Ø¨Ø±Ù…Ø¬ÙŠØ© Ø¨Ø³ÙŠØ·Ø©.'},
                            {role: 'user', content: "Ù‡Ø°Ø§ ÙƒÙˆØ¯ÙŠ: " + code}
                        ]
                    })
                });
                loading.innerText = await res.text();
            } catch { loading.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯."; }
        }

        function loadLesson(code, name) {
            document.getElementById('editor').value = code;
            switchView('view-editor', document.getElementById('nav-editor'));
            window.notifyAI("ØªÙ… ØªØ­Ù…ÙŠÙ„ " + name);
        }

        async function sendAI() {
            const input = document.getElementById('ai-input');
            const txt = input.value.trim();
            if(!txt) return;
            addChat("user", txt);
            input.value = "";
            const bot = addChat("ai", "ÙŠÙÙƒØ±...");
            const res = await fetch('https://text.pollinations.ai/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({messages: [{role:'user', content:txt}]})
            });
            bot.innerText = await res.text();
        }

        function addChat(role, text) {
            const flow = document.getElementById('chat-flow');
            const div = document.createElement('div');
            div.style = role === 'user' ? "align-self:flex-end; background:#dcf8c6; padding:10px; border-radius:10px; font-size:0.85rem; max-width:80%;" : "align-self:flex-start; background:white; padding:10px; border-radius:10px; font-size:0.85rem; max-width:80%; border-right:3px solid var(--ai-color);";
            div.innerText = text;
            flow.appendChild(div);
            flow.scrollTop = flow.scrollHeight;
            return div;
        }
    </script>
</body>
</html>
