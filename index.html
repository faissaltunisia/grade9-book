<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.11.0/brython_stdlib.min.js"></script>

    <style>
        :root {
            --oman-red: #d92027; --oman-green: #007e33; --tech-blue: #004a99;
            --dark-bg: #1e1e1e; --sidebar-w: 250px; --ai-w: 380px;
        }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; display: flex; flex-direction: column; background: #f0f2f5; }

        /* Ø§Ù„Ù‡ÙŠÙƒÙ„ */
        .main-layout { display: flex; flex: 1; width: 100%; height: 100%; overflow: hidden; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .sidebar { width: var(--sidebar-w); background: white; border-left: 2px solid #ddd; display: flex; flex-direction: column; }
        .sidebar-header { background: var(--tech-blue); color: white; padding: 15px; font-weight: bold; text-align: center; }
        .lesson-list { flex: 1; overflow-y: auto; padding: 10px; }
        .lesson-item { padding: 12px; background: #f8f9fa; margin-bottom: 8px; border-radius: 8px; cursor: pointer; border-right: 4px solid var(--oman-red); font-size: 0.9rem; transition: 0.3s; }
        .lesson-item:hover { background: #e3f2fd; }

        /* Ø§Ù„ÙˆØ³Ø· (Ø§Ù„Ù…Ø­Ø±Ø±) */
        .editor-zone { flex: 1; display: flex; flex-direction: column; padding: 10px; background: #fff; }
        .toolbar { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 10px; margin-bottom: 10px; border: 1px solid #ddd; }
        #editor { flex: 1; background: var(--dark-bg); color: #adff2f; padding: 15px; border-radius: 10px; font-family: 'Consolas', monospace; font-size: 1.1rem; resize: none; border: none; outline: none; }
        .terminal { height: 120px; background: #000; color: #fff; margin-top: 10px; border-radius: 10px; padding: 10px; overflow-y: auto; font-family: monospace; border: 2px solid #444; }

        /* Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ AI */
        .ai-panel { width: var(--ai-w); background: #e5ddd5; border-right: 2px solid #ddd; display: flex; flex-direction: column; }
        .ai-header { padding: 15px; background: #075e54; color: white; display: flex; align-items: center; gap: 10px; }
        .chat-flow { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 12px; border-radius: 12px; max-width: 85%; font-size: 0.95rem; line-height: 1.4; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .msg.ai { background: white; align-self: flex-start; border-right: 4px solid var(--oman-green); }
        .msg.user { background: #dcf8c6; align-self: flex-end; }
        .chat-footer { padding: 10px; background: #f0f0f0; display: flex; gap: 8px; border-top: 1px solid #ddd; }
        .chat-footer input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #ccc; outline: none; }
        .send-btn { background: #075e54; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ÙƒØªØ§Ø¨ */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 600px; height: 80vh; border-radius: 15px; display: flex; flex-direction: column; overflow: hidden; }
        .modal-body { flex: 1; padding: 20px; overflow-y: auto; text-align: center; line-height: 1.6; }
        .modal-footer { padding: 15px; background: #eee; display: flex; justify-content: space-between; }

        .hidden { display: none; }
        @media (max-width: 900px) { .sidebar { display: none; } .main-layout { flex-direction: column; } .ai-panel { width: 100%; height: 45%; } }
    </style>
</head>
<body onload="brython()">

    <div class="main-layout">
        <aside class="sidebar">
            <div class="sidebar-header">Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</div>
            <div class="lesson-list">
                <div class="lesson-item" onclick="setLesson('print(\'Ù…Ø¯Ø±Ø³Ø© ØµÙ„Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©\')', 'Ù†Ø´Ø§Ø· 1')">Ù†Ø´Ø§Ø· 1: Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</div>
                <div class="lesson-item" onclick="setLesson('x = 5\ny = 3\nprint(x + y)', 'Ù†Ø´Ø§Ø· 2')">Ù†Ø´Ø§Ø· 2: Ø§Ù„Ø­Ø³Ø§Ø¨</div>
                <div class="lesson-item" onclick="openBook()">ğŸ“– ØªØµÙØ­ Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</div>
            </div>
        </aside>

        <section class="editor-zone">
            <div class="toolbar">
                <strong id="task-title" style="color:var(--tech-blue)">Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø­Ø±</strong>
                <div>
                    <button onclick="magicHelp()" style="background:#9c27b0; color:white; border:none; padding:8px 12px; border-radius:5px; cursor:pointer;">Ù…Ø³Ø§Ø¹Ø¯Ø© Ø³Ø­Ø±ÙŠØ© âœ¨</button>
                    <button id="run_btn" style="background:var(--oman-green); color:white; border:none; padding:8px 20px; border-radius:5px; cursor:pointer; font-weight:bold;">ØªØ´ØºÙŠÙ„ â–¶</button>
                </div>
            </div>
            <textarea id="editor" spellcheck="false">print("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØªÙÙ‚Ù†ÙŠ Ø§Ù„Ø°ÙƒÙŠ")</textarea>
            <div class="terminal" id="output">>>> Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>
        </section>

        <section class="ai-panel">
            <div class="ai-header"><i class="fa-solid fa-robot"></i> <strong>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ ØªÙÙ‚Ù†ÙŠ</strong></div>
            <div class="chat-flow" id="chat-flow">
                <div class="msg ai">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ø§Ø¶ØºØ· "Ù…Ø³Ø§Ø¹Ø¯Ø© Ø³Ø­Ø±ÙŠØ©" Ù„Ø£Ø­Ù„Ù„ Ù„Ùƒ Ø§Ù„ÙƒÙˆØ¯.</div>
            </div>
            <div class="chat-footer">
                <input type="text" id="ai-input" placeholder="Ø§Ø³Ø£Ù„ ØªÙÙ‚Ù†ÙŠ Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡..." onkeypress="if(event.key==='Enter') userSendMessage()">
                <button class="send-btn" onclick="userSendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </section>
    </div>

    <div id="book-modal" class="modal">
        <div class="modal-content">
            <div class="modal-body" id="book-content">
                <h3>ÙƒØªØ§Ø¨ ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h3>
                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø³...</p>
            </div>
            <div class="modal-footer">
                <button onclick="closeBook()">Ø¥ØºÙ„Ø§Ù‚</button>
                <span>Ø§Ù„ØµÙØ­Ø© 1 Ù…Ù† 1</span>
            </div>
        </div>
    </div>

    <script type="text/python">
        from browser import document, window
        def run_code(ev):
            document["output"].text = ""
            def log(*args): document["output"].text += " ".join(map(str, args)) + "\n"
            try:
                exec(document["editor"].value, {"print": log, "input": window.prompt})
            except Exception as e:
                document["output"].text = f"Ø®Ø·Ø£: {e}"
        document["run_btn"].bind("click", run_code)
    </script>

    <script>
        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø·Ø§Ù„Ø¨
        async function userSendMessage() {
            const input = document.getElementById('ai-input');
            const text = input.value.trim();
            if (!text) return;
            await processAIRequest(text);
            input.value = "";
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ© (Ø§Ù„Ø¢Ù† ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ‚Ù„)
        async function magicHelp() {
            const code = document.getElementById('editor').value;
            const task = document.getElementById('task-title').innerText;
            const prompt = `Ø£Ù†Ø§ Ø£Ø­Ø§ÙˆÙ„ Ø­Ù„ "${task}". Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ: \n${code}\n Ø§Ø´Ø±Ø­ Ù„ÙŠ Ø§Ù„Ø®Ø·Ø£ ÙˆØ³Ø§Ø¹Ø¯Ù†ÙŠ ÙÙŠ Ø§Ù„Ø­Ù„.`;
            await processAIRequest(prompt);
        }

        // Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
        async function processAIRequest(message) {
            addChat("user", message);
            const loading = addChat("ai", "ØªÙÙ‚Ù†ÙŠ ÙŠÙÙƒØ±... âœï¸");

            try {
                const response = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: 'Ø£Ù†Øª ØªÙÙ‚Ù†ÙŠØŒ Ù…Ø¹Ù„Ù… Ø­Ø§Ø³ÙˆØ¨ Ø¹Ù…Ø§Ù†ÙŠ Ø°ÙƒÙŠ ÙˆÙ…Ø³Ø§Ø¹Ø¯ Ù„Ù„Ø·Ù„Ø§Ø¨.' },
                            { role: 'user', content: message }
                        ]
                    })
                });
                const data = await response.text();
                loading.innerText = data;
            } catch (e) {
                loading.innerText = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£Ø³ØªØ·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….";
            }
        }

        function addChat(role, text) {
            const flow = document.getElementById('chat-flow');
            const div = document.createElement('div');
            div.className = "msg " + role;
            div.innerText = text;
            flow.appendChild(div);
            flow.scrollTop = flow.scrollHeight;
            return div;
        }

        function setLesson(code, title) {
            document.getElementById('editor').value = code;
            document.getElementById('task-title').innerText = title;
        }

        function openBook() { 
            document.getElementById('book-modal').style.display = 'flex';
            document.getElementById('book-content').innerHTML = `
                <img src="https://img.freepik.com/free-vector/code-testing-concept-illustration_114360-1141.jpg" width="200">
                <h3>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</h3>
                <p>Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© <b>print</b> ØªØ³ØªØ®Ø¯Ù… Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©. <br> Ù…Ø«Ø§Ù„: <code>print("ØµÙ„Ø§Ù„Ø©")</code></p>
            `;
        }
        function closeBook() { document.getElementById('book-modal').style.display = 'none'; }
    </script>
</body>
</html>
